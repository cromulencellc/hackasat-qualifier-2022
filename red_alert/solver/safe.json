{"name":"safe",
    "interval":"10s",
    "rules":[{"expr":"",
    "labels":{"cycle":"{{ $values.LastDetectorCycle.Value }}"},
    "for":"20s",
    "grafana_alert":{"id":2,
    "orgId":1,
    "title":"safe",
    "condition":"PowerDown",
    "data":[
        {"refId":"DetectorState",
        "queryType":"",
        "relativeTimeRange":{"from":600,
        "to":0},
        "datasourceUid":"telemetry_db",
        "model":{"format":"time_series",
        "group":[],
        "hide":false,
        "intervalMs":1000,
        "maxDataPoints":43200,
        "rawQuery":true,
        "rawSql":"SELECT\n  time AS \"time\",
        \n  state\nFROM detector\nORDER BY 1",
        "metricColumn":"none",
        "refId":"DetectorState",
        "select":[[{"params":["state"],
        "type":"column"}]],
        "table":"detector",
        "timeColumn":"time",
        "timeColumnType":"timestamp",
        "where":[]
        }},
        {"refId":"Battery",
            "queryType":"",
            "relativeTimeRange":{"from":600,
            "to":0},
            "datasourceUid":"telemetry_db",
            "model":{"format":"time_series",
            "group":[],
            "hide":false,
            "intervalMs":1000,
            "maxDataPoints":43200,
            "metricColumn":"none",
            "rawQuery":true,
            "rawSql":"SELECT\n  time AS \"time\",
            \n  battery\nFROM cdh\nORDER BY 1",
            "refId":"Battery",
            "select":[[{"params":["battery"],
            "type":"column"}]],
            "table":"cdh",
            "timeColumn":"time",
            "timeColumnType":"timestamp",
            "where":[]}},
            {"refId":"Heat",
                "queryType":"",
                "relativeTimeRange":{"from":600,
                "to":0},
                "datasourceUid":"telemetry_db",
                "model":{"format":"time_series",
                "group":[],
                "hide":false,
                "intervalMs":1000,
                "maxDataPoints":43200,
                "metricColumn":"none",
                "rawQuery":true,
                "rawSql":"SELECT\n  time AS \"time\",
            \n  temp\nFROM cdh\nORDER BY 1",
                "refId":"Heat",
                "select":[[{"params":["temp"],
                "type":"column"}]],
                "table":"cdh",
                "timeColumn":"time",
                "timeColumnType":"timestamp",
                "where":[]}},
            {"refId":"DetectorCycle",
                "queryType":"",
                "relativeTimeRange":{"from":600,
                "to":0},
                "datasourceUid":"telemetry_db",
                "model":{"format":"time_series",
                "group":[],
                "hide":false,
                "intervalMs":1000,
                "maxDataPoints":43200,
                "metricColumn":"none",
                "rawQuery":true,
                "rawSql":"SELECT\n  time AS \"time\",
            \n  cycle\nFROM detector\nORDER BY 1",
                "refId":"DetectorCycle",
                "select":[[{"params":["cycle"],
                "type":"column"}]],
                "table":"detector",
                "timeColumn":"time",
                "timeColumnType":"timestamp",
                "where":[]}},
                {"refId":"LastDetectorCycle",
                    "queryType":"",
                    "relativeTimeRange":{"from":0,
                    "to":0},
                    "datasourceUid":"-100",
                    "model":{"conditions":[{"evaluator":{"params":[0,
                    0],
                    "type":"gt"},
                    "operator":{"type":"and"},
                    "query":{"params":[]},
                    "reducer":{"params":[],
                    "type":"avg"},
                    "type":"query"}],
                    "datasource":{"type":"__expr__",
                    "uid":"__expr__"},
                    "expression":"DetectorCycle",
                    "hide":false,
                    "intervalMs":1000,
                    "maxDataPoints":43200,
                    "reducer":"last",
                    "refId":"LastDetectorCycle",
                    "type":"reduce"}},
                    {"refId":"LastHeat",
                        "queryType":"",
                        "relativeTimeRange":{"from":0,
                        "to":0},
                        "datasourceUid":"-100",
                        "model":{"conditions":[{"evaluator":{"params":[0,
                        0],
                        "type":"gt"},
                        "operator":{"type":"and"},
                        "query":{"params":[]},
                        "reducer":{"params":[],
                        "type":"avg"},
                        "type":"query"}],
                        "datasource":{"type":"__expr__",
                        "uid":"__expr__"},
                        "expression":"Heat",
                        "hide":false,
                        "intervalMs":1000,
                        "maxDataPoints":43200,
                        "reducer":"last",
                        "refId":"LastHeat",
                        "type":"reduce"}},
                        {"refId":"LastBattery",
                            "queryType":"",
                            "relativeTimeRange":{"from":0,
                            "to":0},
                            "datasourceUid":"-100",
                            "model":{"conditions":[{"evaluator":{"params":[0,
                            0],
                            "type":"gt"},
                            "operator":{"type":"and"},
                            "query":{"params":[]},
                            "reducer":{"params":[],
                            "type":"avg"},
                            "type":"query"}],
                            "datasource":{"type":"__expr__",
                            "uid":"__expr__"},
                            "expression":"Battery",
                            "hide":false,
                            "intervalMs":1000,
                            "maxDataPoints":43200,
                            "reducer":"last",
                            "refId":"LastBattery",
                            "type":"reduce"}},
                            {"refId":"LastDetectorState",
                                "queryType":"",
                                "relativeTimeRange":{"from":0,
                                "to":0},
                                "datasourceUid":"-100",
                                "model":{"conditions":[{"evaluator":{"params":[0,
                                0],
                                "type":"gt"},
                                "operator":{"type":"and"},
                                "query":{"params":[]},
                                "reducer":{"params":[],
                                "type":"avg"},
                                "type":"query"}],
                                "datasource":{"type":"__expr__",
                                "uid":"__expr__"},
                                "expression":"DetectorState",
                                "hide":false,
                                "intervalMs":1000,
                                "maxDataPoints":43200,
                                "reducer":"last",
                                "refId":"LastDetectorState",
                                "type":"reduce"}},
                            {"refId":"PowerDown",
                                "queryType":"",
                                "relativeTimeRange":{"from":0,
                                "to":0},
                                "datasourceUid":"-100",
                                "model":{"conditions":[{"evaluator":{"params":[0,
                                0],
                                "type":"gt"},
                                "operator":{"type":"and"},
                                "query":{"params":[]},
                                "reducer":{"params":[],
                                "type":"avg"},
                                "type":"query"}],
                                "datasource":{"type":"__expr__",
                                "uid":"__expr__"},
                                "expression":"($LastHeat > 350 ) || ($LastBattery < 45 ) || ($LastDetectorState == 1 )",
                                "hide":false,
                                "intervalMs":1000,
                                "maxDataPoints":43200,
                                "refId":"PowerDown",
                                "type":"math"}}
                         
        ],
    "updated":"2022-03-29T15:28:36Z",
    "intervalSeconds":60,
    "version":1,
    "namespace_id":1,
    "rule_group":"safe",
    "no_data_state":"NoData",
    "exec_err_state":"Alerting"}}]}
    