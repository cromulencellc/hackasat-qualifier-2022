{"name":"laser-off",
"interval":"10s",
"rules":[{"expr":"",
"labels":{"cycle":"{{ $values.LastLaserCycle.Value }}"},
"for":"20s",
"grafana_alert":{"id":2,
"orgId":1,
"title":"laser-off",
"condition":"OFF",
"data":[
    {"refId":"LaserState",
    "queryType":"",
    "relativeTimeRange":{"from":600,
    "to":0},
    "datasourceUid":"telemetry_db",
    "model":{"format":"time_series",
    "group":[],
    "hide":false,
    "intervalMs":1000,
    "maxDataPoints":43200,
    "metricColumn":"none",
    "rawQuery":true,
    "rawSql":"SELECT\n  time AS \"time\",
            \n  state\nFROM lasers\nORDER BY 1",
    "refId":"LaserOff",
    "select":[[{"params":["state"],
    "type":"column"}]],
    "table":"lasers",
    "timeColumn":"time",
    "timeColumnType":"timestamp",
    "where":[]
    }},
    {"refId":"Range",
        "queryType":"",
        "relativeTimeRange":{"from":600,
        "to":0},
        "datasourceUid":"telemetry_db",
        "model":{"format":"time_series",
        "group":[],
        "hide":false,
        "intervalMs":1000,
        "maxDataPoints":43200,
        "metricColumn":"none",
        "rawQuery":true,
        "rawSql":"SELECT\n  time AS \"time\",
            \n  range \nFROM detector\nORDER BY 1",
        "refId":"Range",
        "select":[[{"params":["range"],
        "type":"column"}]],
        "table":"detector",
        "timeColumn":"time",
        "timeColumnType":"timestamp",
        "where":[]}},
        {"refId":"LaserCycle",
            "queryType":"",
            "relativeTimeRange":{"from":600,
            "to":0},
            "datasourceUid":"telemetry_db",
            "model":{"format":"time_series",
            "group":[],
            "hide":false,
            "intervalMs":1000,
            "maxDataPoints":43200,
            "metricColumn":"none",
            "rawQuery":true,
            "rawSql":"SELECT\n  time AS \"time\",
            \n  cycle\nFROM lasers\nORDER BY 1",
            "refId":"LaserCycle",
            "select":[[{"params":["cycle"],
            "type":"column"}]],
            "table":"lasers",
            "timeColumn":"time",
            "timeColumnType":"timestamp",
            "where":[]}},
            {"refId":"LastLaserCycle",
                "queryType":"",
                "relativeTimeRange":{"from":0,
                "to":0},
                "datasourceUid":"-100",
                "model":{"conditions":[{"evaluator":{"params":[0,
                0],
                "type":"gt"},
                "operator":{"type":"and"},
                "query":{"params":[]},
                "reducer":{"params":[],
                "type":"avg"},
                "type":"query"}],
                "datasource":{"type":"__expr__",
                "uid":"__expr__"},
                "expression":"LaserCycle",
                "hide":false,
                "intervalMs":1000,
                "maxDataPoints":43200,
                "reducer":"last",
                "refId":"LastLaserCycle",
                "type":"reduce"}},
                {"refId":"LastLaserState",
                    "queryType":"",
                    "relativeTimeRange":{"from":0,
                    "to":0},
                    "datasourceUid":"-100",
                    "model":{"conditions":[{"evaluator":{"params":[0,
                    0],
                    "type":"gt"},
                    "operator":{"type":"and"},
                    "query":{"params":[]},
                    "reducer":{"params":[],
                    "type":"avg"},
                    "type":"query"}],
                    "datasource":{"type":"__expr__",
                    "uid":"__expr__"},
                    "expression":"LaserState",
                    "hide":false,
                    "intervalMs":1000,
                    "maxDataPoints":43200,
                    "reducer":"last",
                    "refId":"LastLaserState",
                    "type":"reduce"}},
                    {"refId":"LastRange",
                        "queryType":"",
                        "relativeTimeRange":{"from":0,
                        "to":0},
                        "datasourceUid":"-100",
                        "model":{"conditions":[{"evaluator":{"params":[0,
                        0],
                        "type":"gt"},
                        "operator":{"type":"and"},
                        "query":{"params":[]},
                        "reducer":{"params":[],
                        "type":"avg"},
                        "type":"query"}],
                        "datasource":{"type":"__expr__",
                        "uid":"__expr__"},
                        "expression":"Range",
                        "hide":false,
                        "intervalMs":1000,
                        "maxDataPoints":43200,
                        "reducer":"last",
                        "refId":"LastRange",
                        "type":"reduce"}},
                        {"refId":"OFF",
                            "queryType":"",
                            "relativeTimeRange":{"from":0,
                            "to":0},
                            "datasourceUid":"-100",
                            "model":{"conditions":[{"evaluator":{"params":[0,
                            0],
                            "type":"gt"},
                            "operator":{"type":"and"},
                            "query":{"params":[]},
                            "reducer":{"params":[],
                            "type":"avg"},
                            "type":"query"}],
                            "datasource":{"type":"__expr__",
                            "uid":"__expr__"},
                            "expression":"($LastLaserState == 1 ) && ($LastRange > 4000 ) ",
                            "hide":false,
                            "intervalMs":1000,
                            "maxDataPoints":43200,
                            "refId":"OFF",
                            "type":"math"}}
                     
    ],
"updated":"2022-03-29T15:28:36Z",
"intervalSeconds":60,
"version":1,
"namespace_id":1,
"rule_group":"laser-off",
"no_data_state":"NoData",
"exec_err_state":"Alerting"}}]}
